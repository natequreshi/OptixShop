generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String         @id @default(cuid())
  email         String         @unique
  emailVerified DateTime?
  name          String
  password      String
  role          UserRole       @default(CASHIER)
  phone         String?
  avatar        String?
  isActive      Boolean        @default(true)
  businessId    String
  locationIds   String[]       @default([])
  createdAt     DateTime       @default(now())
  updatedAt     DateTime
  sessions      sessions[]
  transactions  transactions[]
  businesses    businesses     @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@map("users")
}

model Setting {
  id       String @id @default(cuid())
  key      String @unique
  value    String @default("")
  category String @default("general")

  @@map("settings")
}

model Brand {
  id          String     @id @default(cuid())
  name        String
  slug        String
  description String?
  logo        String?
  businessId  String
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime
  businesses  businesses @relation(fields: [businessId], references: [id], onDelete: Cascade)
  products    Product[]

  @@unique([businessId, slug])
  @@map("brands")
}

model Product {
  id                 String               @id @default(cuid())
  name               String
  slug               String
  sku                String
  barcode            String?
  description        String?
  shortDescription   String?
  type               ProductType          @default(SIMPLE)
  businessId         String
  categoryId         String?
  brandId            String?
  unitId             String?
  taxRate            Float                @default(0)
  images             String[]             @default([])
  videos             String[]             @default([])
  cost               Float                @default(0)
  price              Float
  comparePrice       Float?
  trackInventory     Boolean              @default(true)
  lowStockAlert      Int?
  weight             Float?
  weightUnit         String?
  dimensions         Json?
  isActive           Boolean              @default(true)
  isFeatured         Boolean              @default(false)
  publishToWeb       Boolean              @default(false)
  metaTitle          String?
  metaDescription    String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  inventory          Inventory[]
  product_variations product_variations[]
  brands             Brand?               @relation(fields: [brandId], references: [id])
  businesses         businesses           @relation(fields: [businessId], references: [id], onDelete: Cascade)
  categories         categories?          @relation(fields: [categoryId], references: [id])
  transaction_items  transaction_items[]

  @@unique([businessId, sku])
  @@map("products")
}

model Inventory {
  id                 String              @id @default(cuid())
  locationId         String
  productId          String
  variationId        String?
  quantity           Float               @default(0)
  alertQuantity      Float?
  updatedAt          DateTime
  locations          locations           @relation(fields: [locationId], references: [id], onDelete: Cascade)
  products           Product             @relation(fields: [productId], references: [id], onDelete: Cascade)
  product_variations product_variations? @relation(fields: [variationId], references: [id], onDelete: Cascade)

  @@unique([locationId, productId, variationId])
  @@map("inventory")
}

model Customer {
  id           String         @id @default(cuid())
  name         String
  email        String?
  phone        String?
  businessId   String
  customerType CustomerType   @default(WALK_IN)
  companyName  String?
  taxNumber    String?
  address      String?
  city         String?
  state        String?
  zipCode      String?
  country      String?
  creditLimit  Float          @default(0)
  balance      Float          @default(0)
  points       Int            @default(0)
  notes        String?
  isActive     Boolean        @default(true)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  businesses   businesses     @relation(fields: [businessId], references: [id], onDelete: Cascade)
  transactions transactions[]

  @@map("customers")
}

model Payment {
  id            String        @id @default(cuid())
  transactionId String
  amount        Float
  method        PaymentMethod
  reference     String?
  notes         String?
  createdAt     DateTime      @default(now())
  transactions  transactions  @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@map("payments")
}

model businesses {
  id              String         @id
  name            String
  email           String?
  phone           String?
  address         String?
  city            String?
  state           String?
  country         String?
  zipCode         String?
  taxNumber       String?
  currency        String         @default("USD")
  dateFormat      String         @default("MM/DD/YYYY")
  timeZone        String         @default("UTC")
  fiscalYearStart DateTime       @default(now())
  fiscalYearEnd   DateTime       @default(now())
  logo            String?
  settings        Json?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime
  brands          Brand[]
  categories      categories[]
  customers       Customer[]
  locations       locations[]
  products        Product[]
  transactions    transactions[]
  users           User[]
}

model categories {
  id               String       @id
  name             String
  slug             String
  description      String?
  image            String?
  parentId         String?
  businessId       String
  isActive         Boolean      @default(true)
  createdAt        DateTime     @default(now())
  updatedAt        DateTime
  businesses       businesses   @relation(fields: [businessId], references: [id], onDelete: Cascade)
  categories       categories?  @relation("categoriesTocategories", fields: [parentId], references: [id])
  other_categories categories[] @relation("categoriesTocategories")
  products         Product[]

  @@unique([businessId, slug])
}

model locations {
  id           String         @id
  name         String
  code         String
  businessId   String
  address      String?
  city         String?
  state        String?
  zipCode      String?
  phone        String?
  email        String?
  isActive     Boolean        @default(true)
  settings     Json?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  inventory    Inventory[]
  businesses   businesses     @relation(fields: [businessId], references: [id], onDelete: Cascade)
  transactions transactions[]

  @@unique([businessId, code])
}

model product_variations {
  id                String              @id
  productId         String
  name              String
  sku               String
  barcode           String?
  price             Float
  cost              Float               @default(0)
  image             String?
  attributes        Json
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  inventory         Inventory[]
  products          Product             @relation(fields: [productId], references: [id], onDelete: Cascade)
  transaction_items transaction_items[]

  @@unique([productId, sku])
}

model sessions {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  users        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model transaction_items {
  id                 String              @id
  transactionId      String
  productId          String
  variationId        String?
  name               String
  sku                String
  quantity           Float
  unitPrice          Float
  cost               Float               @default(0)
  taxRate            Float               @default(0)
  taxAmount          Float               @default(0)
  discountType       DiscountType?
  discountValue      Float               @default(0)
  discountAmount     Float               @default(0)
  subtotal           Float
  total              Float
  createdAt          DateTime            @default(now())
  products           Product             @relation(fields: [productId], references: [id])
  transactions       transactions        @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  product_variations product_variations? @relation(fields: [variationId], references: [id])
}

model transactions {
  id                String              @id
  invoiceNo         String              @unique
  type              TransactionType
  status            TransactionStatus   @default(FINAL)
  businessId        String
  locationId        String
  customerId        String?
  userId            String
  transactionDate   DateTime            @default(now())
  dueDate           DateTime?
  subtotal          Float
  taxAmount         Float               @default(0)
  discountType      DiscountType?
  discountValue     Float               @default(0)
  discountAmount    Float               @default(0)
  shippingCost      Float               @default(0)
  total             Float
  paidAmount        Float               @default(0)
  changeAmount      Float               @default(0)
  paymentStatus     PaymentStatus       @default(PENDING)
  paymentMethod     String?
  notes             String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  payments          Payment[]
  transaction_items transaction_items[]
  businesses        businesses          @relation(fields: [businessId], references: [id], onDelete: Cascade)
  customers         Customer?           @relation(fields: [customerId], references: [id])
  locations         locations           @relation(fields: [locationId], references: [id])
  users             User                @relation(fields: [userId], references: [id])
}

enum CustomerType {
  WALK_IN
  REGULAR
  WHOLESALE
  VIP
}

enum DiscountType {
  FIXED
  PERCENTAGE
}

enum PaymentMethod {
  CASH
  CARD
  BANK_TRANSFER
  MOBILE_MONEY
  CHECK
  OTHER
}

enum PaymentStatus {
  PENDING
  PARTIAL
  PAID
  OVERPAID
}

enum ProductType {
  SIMPLE
  VARIABLE
  SERVICE
}

enum TransactionStatus {
  DRAFT
  PENDING
  FINAL
  CANCELLED
}

enum TransactionType {
  SALE
  PURCHASE
  RETURN
  ADJUSTMENT
  TRANSFER
}

enum UserRole {
  OWNER
  ADMIN
  MANAGER
  CASHIER
  SALES_PERSON
}
